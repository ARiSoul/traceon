<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Arisoul.Traceon.App.Views.TrackedActionCreateOrEditPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:btns="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
    xmlns:fonts="clr-namespace:Arisoul.Traceon.App.Resources.Fonts"
    xmlns:locArisoul="clr-namespace:Arisoul.Localization.Strings;assembly=Arisoul.Localization"
    xmlns:locTraceon="clr-namespace:Arisoul.Traceon.Localization;assembly=Traceon.Localization"
    xmlns:m="clr-namespace:Arisoul.Traceon.Maui.Core.Entities;assembly=Traceon.Maui.Core"
    xmlns:vm="clr-namespace:Arisoul.Traceon.App.ViewModels"
    Title="{Binding Title}"
    x:DataType="vm:TrackedActionCreateOrEditViewModel">

    <ScrollView>
        <VerticalStackLayout Margin="20" Spacing="5">

            <Label Text="{x:Static locArisoul:Messages.Name}" />
            <Entry IsTextPredictionEnabled="True" Text="{Binding TrackedAction.Name}" />

            <Label Text="{x:Static locArisoul:Messages.Description}" />
            <Entry IsTextPredictionEnabled="True" Text="{Binding TrackedAction.Description}" />


            <!--  SelectedItem="{Binding SelectedActionField, Mode=TwoWay}"  -->
            <CollectionView ItemsSource="{Binding TrackedAction.Fields}" SelectionMode="Single">
                <CollectionView.Header>
                    <!--  Command="{Binding AddActionFieldCommand}"  -->
                    <Grid>
                        <Label
                            FontAttributes="Bold"
                            HorizontalOptions="Center"
                            Text="Fields"
                            VerticalOptions="Center" />
                        <btns:SfButton
                            Margin="0,5"
                            FontFamily="FAR"
                            HorizontalOptions="End"
                            Text="{x:Static fonts:IconFont.SquarePlus}" />
                    </Grid>
                </CollectionView.Header>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="m:ActionField">
                        <Grid ColumnDefinitions="*,auto" HorizontalOptions="Fill">

                            <Grid
                                Grid.Column="0"
                                Margin="0,10"
                                Padding="10"
                                ColumnDefinitions="*,auto"
                                RowDefinitions="*,*,*">
                                <Label
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    FontAttributes="Bold"
                                    FontSize="18"
                                    Text="{Binding Name, Mode=TwoWay}" />
                                <Label
                                    Grid.Row="1"
                                    Grid.RowSpan="2"
                                    Grid.Column="0"
                                    FontSize="13"
                                    Text="{Binding Description, Mode=TwoWay}"
                                    TextColor="Gray" />
                                <Label
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    FontSize="16"
                                    HorizontalTextAlignment="Center"
                                    Text="Entries" />
                                <btns:SfButton
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    Background="LimeGreen"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TrackedActionsViewModel}}, Path=HandleSelectedActionCommand}"
                                    CommandParameter="{Binding .}"
                                    CornerRadius="40"
                                    WidthRequest="40">
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        HorizontalOptions="Center"
                                        Text="{Binding Entries.Count}"
                                        TextColor="White"
                                        VerticalOptions="Center" />
                                </btns:SfButton>
                                <BoxView
                                    Grid.Row="2"
                                    Grid.ColumnSpan="3"
                                    HeightRequest="1"
                                    Color="White" />
                            </Grid>

                            <HorizontalStackLayout
                                Grid.Column="1"
                                Padding="15"
                                Spacing="3">

                                <ImageButton
                                    BackgroundColor="Transparent"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TrackedActionsViewModel}}, Path=CreateOrEditActionCommand}"
                                    CommandParameter="{Binding .}">
                                    <ImageButton.Source>
                                        <FontImageSource
                                            FontFamily="FAR"
                                            Glyph="{x:Static fonts:IconFont.PenToSquare}"
                                            Size="24"
                                            Color="Green" />
                                    </ImageButton.Source>
                                </ImageButton>

                                <ImageButton
                                    BackgroundColor="Transparent"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TrackedActionsViewModel}}, Path=DeleteActionCommand}"
                                    CommandParameter="{Binding .}">
                                    <ImageButton.Source>
                                        <FontImageSource
                                            FontFamily="FAR"
                                            Glyph="{x:Static fonts:IconFont.TrashCan}"
                                            Size="24"
                                            Color="Red" />
                                    </ImageButton.Source>
                                </ImageButton>
                            </HorizontalStackLayout>

                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <btns:SfButton
                Margin="0,5"
                Command="{Binding SaveActionCommand}"
                Text="{x:Static locArisoul:Messages.Save}"
                VerticalOptions="End" />
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
